<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width" />
<title>Index</title>
</head>
<body>
<div id="msg_id">
</div>
<button id="conn_btn" type="button" style="visibility:hidden" onclick="connect()">
    Connect
</button>
<button id="send_btn" type="button" style="visibility:hidden" onclick="send()">
    Send
</button>

<script>
    var msgDiv = document.getElementById('msg_id');
    var connBtn = document.getElementById('conn_btn');
    var sendBtn = document.getElementById('send_btn');
    var currentAccount = null;

    async function send() {
        const txHash = await ethereum.request({ // @todo check if all went good
            method: 'eth_sendTransaction',
            params: [{
                to: '0x6cC5C2AB53F1876F3E663e5A4B496D6a2326665D',
                from: ethereum.selectedAddress,
                value: '0x2386f26fc10000'
            }]
        });
    }

    function handleAccountsChanged(accounts) {
        if (accounts.length === 0) {
            // MetaMask is locked or the user has not connected any accounts
            console.log('Please connect to MetaMask.');
            connBtn.style.visibility = 'visible';

        } else if (accounts[0] !== currentAccount) {
            currentAccount = accounts[0];
            sendBtn.style.visibility = 'visible';
        }
    }

    function connect() {
        connBtn.style.visibility = 'hidden';

        ethereum
            .request({ method: 'eth_requestAccounts' })
            .then(handleAccountsChanged)
            .catch((err) => {
                if (err.code === 4001) {
                    // EIP-1193 userRejectedRequest error
                    // If this happens, the user rejected the connection request.
                    console.log('Please connect to MetaMask.');  // @todo show this message in the UI
                } else {
                    console.error(err);  // @todo show this message in the UI
                }
                connBtn.style.visibility = 'visible';
            });
    }
    
    if (typeof window.ethereum !== 'undefined') {
        msgDiv.textContent = 'Good! You have an installed Ethereum wallet.';

        if (ethereum.isMetaMask) {
            msgDiv.innerHTML += '<br /> And it is MetaMask.';
            connBtn.style.visibility = 'visible';
        }
    } else {
        msgDiv.textContent = 'Sorry, no wallet installed :(';
    }
</script>
</body>
</html>